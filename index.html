<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>èµ°å¤±äººå‘˜è¡Œèµ°è·ç¦»è®¡ç®—å™¨</title>
  <style>
    :root {
      --bg: #ffffff;
      --card-bg: #f9f9fb;
      --text: #1d1d1f;
      --text-secondary: #6e6e73;
      --border: #e5e5ea;
      --accent: #007aff;
      --warning: #ff3b30;
      --info: #5e5ce6;
      --disabled: #c7c7cc;
      --radius: 16px;
      --item-radius: 8px;
      --shadow: 0 4px 16px rgba(0,0,0,0.06);
    }

    [data-theme="dark"] {
      --bg: #000000;
      --card-bg: #1c1c1e;
      --text: #f5f5f7;
      --text-secondary: #aeaeb2;
      --border: #3a3a3c;
      --shadow: 0 4px 16px rgba(0,0,0,0.15);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro SC', 'PingFang SC', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.5;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-size: clamp(24px, 5vw, 28px);
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 20px;
      background: linear-gradient(to right, var(--text), var(--text-secondary));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .theme-toggle {
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: var(--text);
    }

    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 24px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }

    h2 {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text);
    }

    label {
      display: block;
      margin: 22px 0 10px;
      font-weight: 600;
      font-size: 16px;
      color: var(--text);
    }

    select,
    input[type="number"],
    input[type="time"] {
      width: 100%;
      padding: 15px;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text);
      font-size: 17px;
      appearance: none;
    }

    select:focus,
    input[type="number"]:focus,
    input[type="time"]:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0,122,255,0.15);
    }

    .gender-group {
      display: flex;
      gap: 16px;
      margin-top: 8px;
    }

    .gender-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: normal;
      margin: 0;
      padding: 12px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      cursor: pointer;
    }

    .checkbox-label {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      font-weight: normal;
      margin-top: 8px;
      font-size: 16px;
      color: var(--text);
    }

    .checkbox-label input[type="checkbox"] {
      margin-top: 4px;
      width: 18px;
      height: 18px;
    }

    .checkbox-desc {
      font-size: 13px;
      color: var(--text-secondary);
      margin-left: 28px;
      margin-top: -6px;
    }

    button[type="submit"] {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 18px;
      font-size: 17px;
      font-weight: 600;
      width: 100%;
      cursor: pointer;
      margin-top: 20px;
      transition: background 0.2s, transform 0.1s;
    }

    button[type="submit"]:hover {
      background: #0062cc;
    }

    button[type="submit"]:active {
      transform: scale(0.99);
    }

    #resultCard {
      display: none;
    }

    .result-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
      margin-bottom: 16px;
    }

    .result-item {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--item-radius);
      padding: 10px 12px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      min-height: 70px;
      transition: border-color 0.2s;
    }

    .result-item:hover {
      border-color: var(--accent);
    }

    .result-item-label {
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      line-height: 1.3;
    }

    .result-item-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      line-height: 1.3;
      text-align: right;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 6px;
    }

    .unavailable-tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      background: rgba(199, 199, 204, 0.15);
      color: var(--text-secondary);
      line-height: 1.3;
      text-align: center;
    }

    .abnormal-tag {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      background: rgba(255, 59, 48, 0.15);
      color: var(--warning);
      line-height: 1.3;
    }

    .suggestion-banner {
      background: rgba(0, 122, 255, 0.1);
      border-left: 4px solid var(--accent);
      padding: 14px;
      border-radius: 0 var(--radius) var(--radius) 0;
      font-size: 15px;
      line-height: 1.5;
    }

    .suggestion-banner.warning {
      background: rgba(255, 59, 48, 0.1);
      border-left-color: var(--warning);
      color: var(--warning);
    }

    .suggestion-banner.info {
      background: rgba(94, 92, 230, 0.1);
      border-left-color: var(--info);
      color: var(--text);
    }

    .toggle-btn {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 15px;
      cursor: pointer;
      padding: 8px 0;
      text-align: left;
      font-weight: 600;
      outline: none;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .toggle-btn::after {
      content: "â–¼";
      font-size: 12px;
      transition: transform 0.2s;
    }

    .toggle-btn.expanded::after {
      transform: rotate(180deg);
    }

    footer {
      margin-top: 24px;
    }

    @media (max-width: 600px) {
      .gender-group { flex-direction: column; }
      .container { padding: 16px; }
      .results-grid { grid-template-columns: 1fr; }
      .result-item-value { font-size: 17px; }
    }

    [data-theme="dark"] .card {
      background: #1e1e20;
    }

    [data-theme="dark"] .result-item {
      background: #161618;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>å¤±è¸ªäººå‘˜æœç´¢æ”¯æ´å·¥å…·<br><span style="font-size:16px;font-weight:400;color:var(--text-secondary);">(ä»…é™ä¸“ä¸šæœæ•‘äººå‘˜ä½¿ç”¨)</span></h1>
      <button id="themeToggle" class="theme-toggle" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ“</button>
    </div>

    <div class="card">
      <form id="searchForm">
        <label for="ageInput">å¹´é¾„ï¼ˆå²ï¼‰</label>
        <input type="number" id="ageInput" min="1" max="120" value="30" />

        <label>æ€§åˆ«</label>
        <div class="gender-group">
          <label><input type="radio" name="gender" value="male" checked /> ç”·</label>
          <label><input type="radio" name="gender" value="female" /> å¥³</label>
        </div>

        <label for="durationInput">å¤±è¸ªæ—¶é—´ï¼ˆå°æ—¶ï¼‰</label>
        <p style="font-size:14px;color:var(--text-secondary);margin-top:-8px;">
          æ³¨ï¼šæŒ‡ä»â€œæœ€åå‡ºç°æ—¶é—´â€åˆ°å½“å‰çš„æ—¶é—´å·®ã€‚
        </p>
        <input type="number" id="durationInput" min="0.1" step="0.1" value="6" />

        <label for="lastSeenTime">æœ€åå‡ºç°æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰</label>
        <input type="time" id="lastSeenTime" value="14:00" />

        <div class="checkbox-label">
          <input type="checkbox" id="isNightActive" />
          <span>è¯¥äººå‘˜å¯èƒ½åœ¨å¤œé—´æ´»åŠ¨ï¼ˆå¦‚ç²¾ç¥å¼‚å¸¸ã€é€ƒäº¡ã€å·²çŸ¥å¤œè¡Œç­‰ï¼‰</span>
        </div>
        <p class="checkbox-desc">
          å‹¾é€‰åå°†å¿½ç•¥22:00â€“6:00çš„å¤œé—´åœèµ°è§„åˆ™ã€‚
        </p>

        <label for="walkMode">è¡Œèµ°æ¨¡å¼</label>
        <select id="walkMode">
          <option value="intermittent" selected>é—´æ­‡è¡Œèµ°ï¼ˆé»˜è®¤ï¼Œå«ä¼‘æ¯/èº²è—ï¼‰</option>
          <option value="continuous">æŒç»­è¡Œèµ°ï¼ˆå…¨ç¨‹ä¸åœï¼Œæç«¯æƒ…å†µï¼‰</option>
        </select>

        <label for="injuryLevel">å—ä¼¤çŠ¶æ€</label>
        <select id="injuryLevel">
          <option value="none" selected>æ— ä¼¤ï¼ˆæ­£å¸¸è¡ŒåŠ¨ï¼‰</option>
          <option value="minor">è½»ä¼¤ï¼ˆå¯è¡Œèµ°ï¼Œç•¥å—å½±å“ï¼‰</option>
          <option value="moderate">ä¸­ä¼¤ï¼ˆè¡ŒåŠ¨ç¼“æ…¢ï¼Œéœ€ä¼‘æ¯ï¼‰</option>
          <option value="severe">é‡ä¼¤ï¼ˆæåº¦å›°éš¾ï¼Œå‡ ä¹æ— æ³•ç§»åŠ¨ï¼‰</option>
        </select>

        <label for="loadLevel">æºå¸¦ç‰©å“è´Ÿé‡</label>
        <select id="loadLevel">
          <option value="none" selected>æ— è´Ÿé‡ï¼ˆç©ºæ‰‹æˆ–è½»ä¾¿åŒ…ï¼‰</option>
          <option value="light">è½»è£…ï¼ˆèƒŒåŒ… â‰¤5kgï¼‰</option>
          <option value="medium">ä¸­ç­‰ï¼ˆè¡Œæ/ç‰©èµ„ 5â€“15kgï¼‰</option>
          <option value="heavy">é‡è£…ï¼ˆè£…å¤‡/ç‰©èµ„ >15kg æˆ–æ‹–æ‹½ç‰©å“ï¼‰</option>
        </select>

        <label for="terrainSelect">åœ°å½¢</label>
        <select id="terrainSelect">
          <option value="city">åŸå¸‚ä¸­å¿ƒ</option>
          <option value="suburb">åŸå¸‚éƒŠåŒº</option>
          <option value="town">ä¹¡é•‡/é›†é•‡</option>
          <option value="village">å†œæ‘/æ‘åº„</option>
          <option value="forest">æ—åŒº/çŒæœ¨ä¸›</option>
          <option value="mountain">å±±åœ°/é‡å¤–</option>
        </select>

        <label for="weatherSelect">å¤©æ°”</label>
        <select id="weatherSelect">
          <option value="clear">æ™´</option>
          <option value="rain">é›¨</option>
          <option value="snow">é›ª</option>
          <option value="extreme">æç«¯ï¼ˆæš´é›¨/æš´é›ªï¼‰</option>
        </select>

        <label for="tempSelect">æ°”æ¸©</label>
        <select id="tempSelect">
          <option value="hot">ç‚çƒ­ï¼ˆ>35â„ƒï¼‰</option>
          <option value="normal" selected>æ­£å¸¸ï¼ˆ10ï½35â„ƒï¼‰</option>
          <option value="cold">å¯’å†·ï¼ˆ0ï½10â„ƒï¼‰</option>
          <option value="freezing">ä¸¥å¯’ï¼ˆ<0â„ƒï¼‰</option>
        </select>

        <label for="customSpeed">è‡ªå®šä¹‰æ­¥è¡Œé€Ÿåº¦ï¼ˆç±³/åˆ†é’Ÿï¼‰</label>
        <input type="number" id="customSpeed" min="10" max="120" placeholder="ç•™ç©ºåˆ™è‡ªåŠ¨è®¡ç®—" />

        <label for="radiusBuffer">æœç´¢åŠå¾„å†—ä½™ç³»æ•°</label>
        <p style="font-size:14px;color:var(--text-secondary);margin-top:-8px;">
          é»˜è®¤1.2ï¼ˆ+20%ï¼‰ï¼Œå»ºè®®èŒƒå›´1.0~2.0ã€‚æ•°å€¼è¶Šå¤§è¦†ç›–è¶Šå¹¿ï¼Œä½†èµ„æºæ¶ˆè€—è¶Šé«˜ã€‚
        </p>
        <input type="number" id="radiusBuffer" min="1.0" max="3.0" step="0.1" value="1.2" />

        <button type="submit">è®¡ç®—æœç´¢èŒƒå›´</button>
      </form>
    </div>

    <div class="card" id="resultCard">
      <div class="result-title">ä¼°ç®—ç»“æœ</div>
      <div class="results-grid" id="resultsGrid"></div>
      <div id="transportWarning" style="margin-top:12px; display:none;"></div>
      <div id="suggestionBanner" class="suggestion-banner"></div>
    </div>

    <div class="card">
      <h2>å…³äºæœ¬å·¥å…·</h2>
      <div style="margin-top:12px;">
        <div>åˆ¶ä½œè€…ï¼šæ•‘æ´å…ˆé”‹ç„å¾·å…¬</div>
        <div style="font-size:14px; color:var(--text-secondary); margin-top:6px;">
          æœ¬å·¥å…·ä¸“ä¸ºæœæ•‘åè°ƒäººå‘˜è®¾è®¡ï¼Œç”¨äºå¿«é€Ÿä¼°ç®—å¤±è¸ªè€…æ½œåœ¨ç§»åŠ¨èŒƒå›´ã€‚
        </div>
        <button id="toggleAlgorithm" class="toggle-btn">
          æŸ¥çœ‹ç®—æ³•å…¬å¼ä¸è¯´æ˜
        </button>
        <div id="algorithmDetails" class="algorithm-details" style="display:none; margin-top:16px; padding-top:16px; border-top:1px solid var(--border); font-size:15px; line-height:1.6;">
          <h3 style="font-weight:600; margin-bottom:12px;">æ ¸å¿ƒç®—æ³•å…¬å¼</h3>
          <p><strong>åŸºç¡€æ­¥è¡Œé€Ÿåº¦ =</strong> æ€§åˆ«å¹´é¾„åŸºå‡† Ã— åœ°å½¢ç³»æ•° Ã— å¤©æ°”ç³»æ•° Ã— æ°”æ¸©ç³»æ•° Ã— å—ä¼¤ç³»æ•° Ã— è´Ÿé‡ç³»æ•°</p>
          <p><strong>ç†è®ºç§»åŠ¨æ—¶é—´ =</strong> å¤±è¸ªæ—¶é—´ Ã— è¡Œèµ°æ¨¡å¼å› å­</p>
          <p><strong>æœ‰æ•ˆç§»åŠ¨æ—¶é—´ =</strong> 
            <span style="color:var(--text);">
              è‹¥æœªå‹¾é€‰â€œå¤œé—´æ´»åŠ¨â€ï¼šç†è®ºç§»åŠ¨æ—¶é—´ âˆ’ å¤œé—´åœèµ°å°æ—¶æ•°ï¼ˆ22:00â€“6:00ï¼‰<br>
              è‹¥å‹¾é€‰â€œå¤œé—´æ´»åŠ¨â€ï¼šç†è®ºç§»åŠ¨æ—¶é—´ï¼ˆä¸æ‰£é™¤å¤œé—´ï¼‰
            </span>
          </p>
          <p><strong>æ­¥è¡Œè·ç¦»ï¼ˆkmï¼‰ =</strong> åŸºç¡€æ­¥è¡Œé€Ÿåº¦ Ã— æœ‰æ•ˆç§»åŠ¨æ—¶é—´ï¼ˆå°æ—¶ï¼‰ Ã· 1000</p>
          <p><strong>å»ºè®®æœç´¢åŠå¾„ï¼ˆkmï¼‰ =</strong> æ­¥è¡Œè·ç¦» Ã— å†—ä½™ç³»æ•°</p>

          <h3 style="font-weight:600; margin:16px 0 12px;">è¡Œèµ°æ¨¡å¼å› å­</h3>
          <ul style="padding-left:20px; margin-bottom:12px;">
            <li>é—´æ­‡è¡Œèµ°ï¼ˆé»˜è®¤ï¼‰ï¼š0.4ï¼ˆçº¦40%æ—¶é—´å®é™…ç§»åŠ¨ï¼‰</li>
            <li>æŒç»­è¡Œèµ°ï¼š1.0ï¼ˆå…¨ç¨‹ä¸åœï¼‰</li>
          </ul>

          <h3>ä¸ªä½“çŠ¶æ€ä¿®æ­£ç³»æ•°</h3>
          <ul style="padding-left:20px;">
            <li>å—ä¼¤çŠ¶æ€ï¼šæ— ä¼¤(1.0)ã€è½»ä¼¤(0.7)ã€ä¸­ä¼¤(0.5)ã€é‡ä¼¤(0.3)</li>
            <li>è´Ÿé‡æƒ…å†µï¼šæ— è´Ÿé‡(1.0)ã€è½»è£…(0.9)ã€ä¸­ç­‰(0.8)ã€é‡è£…(0.6)</li>
          </ul>

          <h3>å¤œé—´åœèµ°è§„åˆ™</h3>
          <ul style="padding-left:20px;">
            <li>é»˜è®¤å¤œé—´æ—¶æ®µï¼š22:00 è‡³æ¬¡æ—¥ 6:00</li>
            <li>è‹¥<strong>æœªå‹¾é€‰â€œæ˜¯å¦å¤œé—´æ´»åŠ¨â€</strong>ï¼Œæ­¤æœŸé—´è§†ä¸ºå®Œå…¨åœæ­¢ç§»åŠ¨</li>
            <li>è‹¥<strong>å‹¾é€‰â€œæ˜¯å¦å¤œé—´æ´»åŠ¨â€</strong>ï¼Œåˆ™å¤œé—´æ—¶é—´æŒ‰è¡Œèµ°æ¨¡å¼æ­£å¸¸è®¡å…¥</li>
            <li>ç³»ç»Ÿè‡ªåŠ¨æ ¹æ®â€œæœ€åå‡ºç°æ—¶é—´â€å’Œâ€œå¤±è¸ªæ—¶é•¿â€ç²¾ç¡®è®¡ç®—å¤œé—´å æ¯”</li>
          </ul>

          <h3>åœ°å½¢ç³»æ•°è¯´æ˜</h3>
          <ul style="padding-left:20px; margin-bottom:12px;">
            <li>åŸå¸‚ä¸­å¿ƒï¼š1.0</li>
            <li>åŸå¸‚éƒŠåŒºï¼š0.85</li>
            <li>ä¹¡é•‡/é›†é•‡ï¼š0.75</li>
            <li>å†œæ‘/æ‘åº„ï¼š0.70</li>
            <li>æ—åŒº/çŒæœ¨ä¸›ï¼š0.35</li>
            <li>å±±åœ°/é‡å¤–ï¼š0.40</li>
          </ul>

          <h3>äº¤é€šå·¥å…·å¼‚å¸¸åˆ¤å®šæ ‡å‡†</h3>
          <ul style="padding-left:20px;">
            <li>åœ°é“/è½»è½¨ > 80 km â†’ å¼‚å¸¸</li>
            <li>å…¬äº¤/æ··åˆäº¤é€š > 50 km â†’ å¼‚å¸¸</li>
            <li>è‡ªè¡Œè½¦ > 30 km â†’ å¼‚å¸¸</li>
            <li>ç”µåŠ¨è‡ªè¡Œè½¦ > 60 km â†’ å¼‚å¸¸</li>
            <li><strong>æ­¥è¡Œ > å¯¹åº”äººç¾¤ç”Ÿç†æé™ â†’ å¼‚å¸¸</strong></li>
          </ul>
          <p>æ³¨ï¼šæ—åŒºã€å±±åœ°ã€æç«¯å¤©æ°”ä¸‹å…¬å…±äº¤é€šåŠéæœºåŠ¨è½¦è‡ªåŠ¨ç¦ç”¨ã€‚</p>
        </div>
      </div>
    </div>

    <footer>
      <div class="card">
        <h2 style="font-size:18px; margin-bottom:12px;">ä½¿ç”¨å£°æ˜ï¼ˆä»…é™ä¸“ä¸šæœæ•‘äººå‘˜ï¼‰</h2>
        <ul style="padding-left:20px; font-size:15px; line-height:1.6; color:var(--text);">
          <li>æœ¬å·¥å…·<strong>ä»…ä½œä¸ºç°åœºæŒ‡æŒ¥è¾…åŠ©å‚è€ƒ</strong>ï¼Œä¸å¾—æ›¿ä»£ä¸“ä¸šæœæ•‘å†³ç­–ç³»ç»Ÿæˆ–å®åœ°ç ”åˆ¤ã€‚</li>
          <li>æ‰€æœ‰è¾“å‡ºç»“æœåŸºäºç®€åŒ–æ¨¡å‹ï¼Œ<strong>æœªè€ƒè™‘ä¸ªä½“è¡Œä¸ºå·®å¼‚ã€éšœç¢ç‰©ã€è·¯å¾„å¯è¾¾æ€§ç­‰å¤æ‚å› ç´ </strong>ã€‚</li>
          <li>ä½¿ç”¨è€…é¡»å…·å¤‡åŸºæœ¬æœæ•‘çŸ¥è¯†ï¼Œå¹¶ç»“åˆåœ°å›¾ã€ç›‘æ§ã€é€šä¿¡å®šä½ç­‰å¤šæºä¿¡æ¯ç»¼åˆåˆ¤æ–­ã€‚</li>
          <li>å¼€å‘è€…ä¸å¯¹å› ä¾èµ–æœ¬å·¥å…·å¯¼è‡´çš„è¡ŒåŠ¨åå·®æˆ–åæœæ‰¿æ‹…ä»»ä½•è´£ä»»ã€‚</li>
        </ul>
      </div>
      <div style="text-align:center; font-size:13px; color:var(--text-secondary); margin-top:16px;">
        Â© 2025 æ•‘æ´æ”¯æ´å·¥å…· | å†…éƒ¨ä¸“ä¸šç”¨é€” | æœ¬åœ°è¿è¡Œ Â· æ— æ•°æ®ä¸Šä¼ 
      </div>
    </footer>
  </div>

  <script>
    // ========== å…¨å±€é…ç½® ==========

    const transitSpeeds = { 
      subway: 35, 
      bus: 20, 
      mixed: 25, 
      bike: 15,
      ebike: 25
    };

    const TRANSIT_THRESHOLDS = {
      subway: 80,
      bus: 50,
      mixed: 50,
      bike: 30,
      ebike: 60
    };

    const WALK_MODE_FACTORS = {
      continuous: 1.0,
      intermittent: 0.4
    };

    const INJURY_FACTORS = {
      none: 1.0,
      minor: 0.7,
      moderate: 0.5,
      severe: 0.3
    };

    const LOAD_FACTORS = {
      none: 1.0,
      light: 0.9,
      medium: 0.8,
      heavy: 0.6
    };

    const WALK_LIMITS = {
      child: { male: 10, female: 8 },
      teen: { male: 30, female: 25 },
      adult: { male: 50, female: 45 },
      senior: { male: 20, female: 15 }
    };

    function getAgeGroup(age) {
      if (age < 12) return 'child';
      if (age <= 17) return 'teen';
      if (age <= 64) return 'adult';
      return 'senior';
    }

    function getBaseWalkSpeed(age, gender) {
      if (age < 12) return 40;
      if (age >= 65) return gender === 'male' ? 45 : 40;
      return gender === 'male' ? 75 : 70;
    }

    function applyTerrainModifier(speed, terrain) {
      switch (terrain) {
        case 'city': return speed;
        case 'suburb': return speed * 0.85;
        case 'town': return speed * 0.75;
        case 'village': return speed * 0.70;
        case 'forest': return speed * 0.35;
        case 'mountain': return speed * 0.40;
        default: return speed;
      }
    }

    function applyWeatherModifier(speed, weather) {
      switch (weather) {
        case 'clear': return speed;
        case 'rain': return speed * 0.8;
        case 'snow':
        case 'extreme': return speed * 0.3;
        default: return speed;
      }
    }

    function applyTempModifier(speed, temp) {
      return temp === 'normal' ? speed : speed * 0.9;
    }

    /**
     * è®¡ç®—å¤œé—´åœèµ°å°æ—¶æ•°ï¼ˆ22:00â€“6:00ï¼‰
     */
    function calculateNightHours(lastSeenTime, durationHours) {
      const NIGHT_START = 22;
      const NIGHT_END = 6;

      const [h, m] = lastSeenTime.split(':').map(Number);
      let currentHour = h + m / 60;
      let nightHours = 0;
      let elapsed = 0;

      while (elapsed < Math.floor(durationHours)) {
        if ((currentHour >= NIGHT_START) || (currentHour < NIGHT_END)) {
          nightHours += 1;
        }
        currentHour = (currentHour + 1) % 24;
        elapsed += 1;
      }

      const fractional = durationHours % 1;
      if (fractional > 0 && elapsed < durationHours) {
        if ((currentHour >= NIGHT_START) || (currentHour < NIGHT_END)) {
          nightHours += fractional;
        }
      }

      return Math.min(nightHours, durationHours);
    }

    function createResultItem(label, value, status = 'normal') {
      const item = document.createElement('div');
      item.className = 'result-item';
      
      const labelEl = document.createElement('div');
      labelEl.className = 'result-item-label';
      labelEl.textContent = label;
      
      const valueEl = document.createElement('div');
      valueEl.className = 'result-item-value';

      if (status === 'unavailable') {
        const tag = document.createElement('span');
        tag.className = 'unavailable-tag';
        tag.textContent = 'ä¸å¯ç”¨';
        valueEl.appendChild(tag);
      } else if (status === 'abnormal') {
        valueEl.textContent = `${value} km`;
        const tag = document.createElement('span');
        tag.className = 'abnormal-tag';
        tag.textContent = 'å¼‚å¸¸';
        valueEl.appendChild(tag);
      } else {
        valueEl.textContent = `${value} km`;
      }

      item.appendChild(labelEl);
      item.appendChild(valueEl);
      return item;
    }

    function calculateAndDisplay() {
      // ========== è·å–ç”¨æˆ·è¾“å…¥ ==========
      const age = parseFloat(document.getElementById('ageInput').value) || 30;
      const gender = document.querySelector('input[name="gender"]:checked').value;
      const duration = parseFloat(document.getElementById('durationInput').value) || 6;
      const lastSeenTime = document.getElementById('lastSeenTime').value || '14:00';
      const isNightActive = document.getElementById('isNightActive').checked;
      const walkMode = document.getElementById('walkMode').value;
      const injuryLevel = document.getElementById('injuryLevel').value;
      const loadLevel = document.getElementById('loadLevel').value;
      const terrain = document.getElementById('terrainSelect').value;
      const weather = document.getElementById('weatherSelect').value;
      const temp = document.getElementById('tempSelect').value;
      const customSpeedInput = document.getElementById('customSpeed').value;
      const bufferInput = document.getElementById('radiusBuffer').value;
      const radiusBuffer = parseFloat(bufferInput) || 1.2;

      // ========== åŸºç¡€æ­¥è¡Œé€Ÿåº¦ ==========
      let walkSpeed = customSpeedInput ? parseFloat(customSpeedInput) : getBaseWalkSpeed(age, gender);

      // ========== ç¯å¢ƒä¸ä¸ªä½“ä¿®æ­£ ==========
      walkSpeed = applyTerrainModifier(walkSpeed, terrain);
      walkSpeed = applyWeatherModifier(walkSpeed, weather);
      walkSpeed = applyTempModifier(walkSpeed, temp);
      walkSpeed *= INJURY_FACTORS[injuryLevel] || 1.0;
      walkSpeed *= LOAD_FACTORS[loadLevel] || 1.0;

      // ========== æœ‰æ•ˆç§»åŠ¨æ—¶é—´è®¡ç®— ==========
      const timeFactor = WALK_MODE_FACTORS[walkMode] || 0.4;
      let theoreticalMoveHours = duration * timeFactor;
      let effectiveMoveHours = theoreticalMoveHours;

      if (!isNightActive) {
        const nightHours = calculateNightHours(lastSeenTime, duration);
        const lostNightMove = Math.min(theoreticalMoveHours, nightHours);
        effectiveMoveHours = Math.max(0, theoreticalMoveHours - lostNightMove);
      }

      // ========== è·ç¦»è®¡ç®— ==========
      const walkDist = (walkSpeed * 60 * effectiveMoveHours) / 1000;
      const radius = walkDist * radiusBuffer;

      // ========== äº¤é€šå·¥å…·å¯ç”¨æ€§ ==========
      const isRemoteArea = terrain === 'mountain' || terrain === 'forest';
      const isSnowOrExtreme = weather === 'snow' || weather === 'extreme';

      const subwayDist = terrain === 'city' ? transitSpeeds.subway * duration : null;
      const busDist = !isRemoteArea ? transitSpeeds.bus * duration : null;
      const mixedDist = !isRemoteArea ? transitSpeeds.mixed * duration : null;
      const bikeDist = (!isRemoteArea && !isSnowOrExtreme) ? transitSpeeds.bike * duration : null;
      const ebikeDist = (!isRemoteArea && !isSnowOrExtreme) ? transitSpeeds.ebike * duration : null;

      const transportData = [
        { key: 'subway', label: 'åœ°é“/è½»è½¨', dist: subwayDist },
        { key: 'bus', label: 'å…¬äº¤', dist: busDist },
        { key: 'mixed', label: 'æ··åˆäº¤é€š', dist: mixedDist },
        { key: 'bike', label: 'è‡ªè¡Œè½¦', dist: bikeDist },
        { key: 'ebike', label: 'ç”µåŠ¨è‡ªè¡Œè½¦', dist: ebikeDist }
      ];

      // ========== æ¸²æŸ“ç»“æœ ==========
      const grid = document.getElementById('resultsGrid');
      grid.innerHTML = '';

      const ageGroup = getAgeGroup(age);
      const maxWalkLimit = WALK_LIMITS[ageGroup][gender];
      const isWalkAbnormalByPhysiology = walkDist > maxWalkLimit;
      const walkStatus = isWalkAbnormalByPhysiology ? 'abnormal' : 'normal';

      grid.appendChild(createResultItem('æ­¥è¡Œæœ€å¤§è·ç¦»', walkDist.toFixed(1), walkStatus));
      grid.appendChild(createResultItem('å»ºè®®æœç´¢åŠå¾„', radius.toFixed(1)));

      const abnormalList = [];
      transportData.forEach(item => {
        let status = 'normal';
        let displayValue = '';
        if (item.dist === null) {
          status = 'unavailable';
        } else {
          displayValue = item.dist.toFixed(1);
          if (item.dist > TRANSIT_THRESHOLDS[item.key]) {
            status = 'abnormal';
            abnormalList.push(`${item.label}ï¼ˆ${displayValue} kmï¼‰`);
          }
        }
        grid.appendChild(createResultItem(item.label, displayValue, status));
      });

      // ========== æç¤ºè¯­ ==========
      const warningEl = document.getElementById('transportWarning');
      if (abnormalList.length > 0) {
        warningEl.innerHTML = `<div class="suggestion-banner warning">ä»¥ä¸‹äº¤é€šå·¥å…·è¡Œè¿›è·ç¦»è¶…å‡ºå¸¸è§„æœåŠ¡èŒƒå›´ï¼Œå¯èƒ½ä¸å…·ç°å®å¯è¡Œæ€§ï¼š<br>${abnormalList.join('ã€')}</div>`;
        warningEl.style.display = 'block';
      } else {
        warningEl.style.display = 'none';
      }

      const banner = document.getElementById('suggestionBanner');
      let suggestionText = '';
      let bannerClass = '';

      if (isWalkAbnormalByPhysiology) {
        let limitDesc = '';
        if (age < 12) limitDesc = `å„¿ç«¥ï¼ˆ${age}å²ï¼‰`;
        else if (age <= 17) limitDesc = `é’å°‘å¹´ï¼ˆ${age}å²ï¼‰`;
        else if (age >= 65) limitDesc = `è€å¹´äººï¼ˆ${age}å²ï¼‰`;
        else limitDesc = `${gender === 'male' ? 'æˆå¹´ç”·æ€§' : 'æˆå¹´å¥³æ€§'}ï¼ˆ${age}å²ï¼‰`;

        const modeDesc = walkMode === 'continuous' ? 'æŒç»­è¡Œèµ°' : 'é—´æ­‡è¡Œèµ°';
        const nightDesc = isNightActive ? 'ï¼ˆå·²å¯ç”¨å¤œé—´æ´»åŠ¨ï¼‰' : 'ï¼ˆå¤œé—´åœèµ°å·²æ‰£é™¤ï¼‰';
        suggestionText = `åœ¨â€œ${modeDesc}â€æ¨¡å¼ä¸‹${nightDesc}ï¼Œä¼°ç®—æ­¥è¡Œè·ç¦»ä¸º ${walkDist.toFixed(1)} kmï¼Œ`;

        suggestionText += `ä»è¿œè¶… ${limitDesc} çš„ç”Ÿç†åˆç†æé™ï¼ˆä¸Šé™çº¦ ${maxWalkLimit} kmï¼‰ã€‚`;
        suggestionText += ' æ­¤ç»“æœé«˜åº¦å¼‚å¸¸ï¼Œå¼ºçƒˆå»ºè®®ï¼š';
        suggestionText += ' â‘  æ ¸å®å¤±è¸ªæ—¶é—´æ˜¯å¦å‡†ç¡®ï¼›â‘¡ æ’æŸ¥äº¤é€šå·¥å…·ä½¿ç”¨ï¼ˆåŒ…æ‹¬éæœºåŠ¨è½¦ã€é¡ºé£è½¦ï¼‰ï¼›';
        suggestionText += ' â‘¢ ç«‹å³åè°ƒå…¬å®‰è°ƒå–ç›‘æ§ã€åŸºç«™ã€å¡å£æ•°æ®ï¼Œè¯„ä¼°æ˜¯å¦å­˜åœ¨è¢«è½¬ç§»å¯èƒ½ã€‚';
        bannerClass = 'warning';
      } 
      else if (walkDist > 20) {
        suggestionText = 'æœç´¢åŠå¾„è¾ƒå¤§ï¼ˆè¶…è¿‡20å…¬é‡Œï¼‰ï¼Œå»ºè®®åè°ƒå¤šæ”¯æœæ•‘é˜Ÿåˆ†åŒºè¦†ç›–ï¼Œå¹¶ä¼˜å…ˆæ’æŸ¥äº¤é€šæ¢çº½ã€åŒ»é™¢ã€ä¾¿åˆ©åº—ç­‰å…³é”®èŠ‚ç‚¹ã€‚';
        bannerClass = '';
      } 
      else if (terrain === 'mountain') {
        suggestionText = 'åœ°å½¢ä¸ºå±±åœ°/é‡å¤–ï¼Œç§»åŠ¨é€Ÿåº¦æ˜¾è‘—é™ä½ã€‚å»ºè®®é›†ä¸­åŠ›é‡åœ¨æœ€åå‡ºç°ç‚¹å‘¨è¾¹5å…¬é‡Œå†…è¿›è¡Œç½‘æ ¼åŒ–åœ°æ¯¯å¼æœç´¢ï¼Œå¹¶æ³¨æ„æ‚¬å´–ã€æ´ç©´ç­‰å±é™©åŒºåŸŸã€‚';
        bannerClass = 'info';
      } 
      else if (terrain === 'forest') {
        suggestionText = 'åœ°å½¢ä¸ºæ—åŒº/çŒæœ¨ä¸›ï¼Œæ¤è¢«å¯†é›†ã€è§†çº¿å—é˜»ã€æ˜“è¿·è·¯ã€‚å»ºè®®ç»„ç»‡ç†Ÿæ‚‰å½“åœ°åœ°å½¢çš„å‘å¯¼å‚ä¸ï¼Œä½¿ç”¨æ— äººæœºçƒ­æˆåƒè¾…åŠ©ï¼Œå¹¶é‡ç‚¹æ’æŸ¥æ—é—´å°é“ã€æ°´æºåœ°ã€çŒäººå°å±‹ç­‰ã€‚';
        bannerClass = 'info';
      } 
      else if (terrain === 'town' || terrain === 'village') {
        suggestionText = 'ä½äºä¹¡é•‡æˆ–å†œæ‘åŒºåŸŸï¼Œå…¬å…±äº¤é€šæœ‰é™ã€‚å»ºè®®è”ç³»å½“åœ°æ‘å§”ä¼šã€å«ç”Ÿæ‰€ã€å°å–éƒ¨ç­‰è·å–ç›®å‡»çº¿ç´¢ï¼Œå¹¶æ‰©å¤§å¯¹å†œç”¨è½¦ã€æ‘©æ‰˜è½¦ã€ç”µåŠ¨è‡ªè¡Œè½¦ç­‰éæ­£è§„äº¤é€šå·¥å…·çš„æ’æŸ¥ã€‚';
        bannerClass = '';
      } 
      else {
        suggestionText = 'æœç´¢èŒƒå›´åˆç†ã€‚å»ºè®®ä»¥æœ€åå‡ºç°åœ°ç‚¹ä¸ºä¸­å¿ƒï¼ŒæŒ‰å»ºè®®åŠå¾„ç»„ç»‡åœ°é¢é˜Ÿä¼è¿›è¡Œç¯å½¢æ‰©æ•£æœç´¢ï¼Œå¹¶åŒæ­¥æ’æŸ¥å‘¨è¾¹ç›‘æ§ã€‚';
        bannerClass = '';
      }

      banner.textContent = suggestionText;
      banner.className = 'suggestion-banner ' + bannerClass;
      document.getElementById('resultCard').style.display = 'block';
    }

    // ========== åˆå§‹åŒ– ==========
    document.addEventListener('DOMContentLoaded', () => {
      const themeToggle = document.getElementById('themeToggle');
      const isDark = localStorage.getItem('theme') === 'dark';
      if (isDark) document.documentElement.setAttribute('data-theme', 'dark');

      themeToggle.addEventListener('click', () => {
        const newTheme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
      });

      document.getElementById('searchForm').addEventListener('submit', e => {
        e.preventDefault();
        calculateAndDisplay();
      });

      document.getElementById('toggleAlgorithm').addEventListener('click', () => {
        const details = document.getElementById('algorithmDetails');
        const btn = document.getElementById('toggleAlgorithm');
        if (details.style.display === 'block') {
          details.style.display = 'none';
          btn.classList.remove('expanded');
        } else {
          details.style.display = 'block';
          btn.classList.add('expanded');
        }
      });
    });
  </script>
</body>
</html>